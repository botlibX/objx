#!/usr/bin/env python3
# This file is placed in the Public Domain.
#
# pylint: disable=C,R,W0201,W0212,W0105,W0613,W0406,E0102,W0612


"objects"


import getpass
import os
import sys


from objx import Client, Command, Default, Error, Storage
from objx import cmnd, mods, parse_command, scan


if os.path.exists("mods"):
    import mods as modules
else:
    modules = None

Cfg          = Default()
Cfg.name     = "objx"
Cfg.version  = "6"
Cfg.wd       = os.path.expanduser(f"~/.{Cfg.name}")
Cfg.pidfile  = os.path.join(Cfg.wd, f"{Cfg.name}.pid")
Cfg.user     = getpass.getuser()
Error.output = print
Storage.wd   = Cfg.wd


class CLI(Client):

    def announce(self, txt):
        if "v" in Cfg.opts:
            self.say("", txt)

    def say(self, channel, txt):
        txt = txt.encode('utf-8', 'replace').decode()
        print(txt)


def main():
    Storage.skel()
    parse_command(Cfg, " ".join(sys.argv[1:]))
    Cfg.mod = ",".join(mods.__dir__())
    if modules:
        Cfg.mod += ",".join(modules.__dir__())
    cli = CLI()
    scan(modules, Cfg.mod)
    scan(mods, Cfg.mod)
    cmnd(Cfg.otxt)
    Error.show()


main()
